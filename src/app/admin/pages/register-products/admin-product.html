<mat-toolbar color="primary"> 
  <span>Productos</span>
  <span class="spacer"></span>

  <button mat-flat-button color="accent" (click)="abrirModal('create')" aria-label="Crear producto">
    + Crear Producto
  </button>
</mat-toolbar>

<div class="container">

  <div *ngIf="mensaje" class="alert" [ngClass]="tipoMensaje" role="alert">
    {{ mensaje }}
  </div>

  <div class="table-wrapper" *ngIf="productos.length > 0; else noData">
    <table class="tabla">
      <thead>
        <tr>
          <th>C贸digo</th>
          <th>Nombre</th>
          <th>Marca</th>
          <th>Precio</th>
          <th>Unidades</th>
          <th>Categor铆as</th>
          <th>Descripci贸n</th>
          <th>Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let producto of productos">
          <td>{{ producto.codigo_producto }}</td>
          <td>{{ producto.fldNombre }}</td>
          <td>{{ producto.fldMarca }}</td>
          <td>{{ producto.fldPrecio }}</td>
          <td>{{ producto.unidades }}</td>
          <td>{{ producto.categorias_nombres }}</td>
          <td>{{ producto.descripcion }}</td>

          <td>
            <button (click)="abrirModal('edit', producto)" aria-label="Editar producto {{producto.fldNombre}}">
              锔 Editar
            </button>

            <button class="danger" (click)="abrirModal('delete', producto)" aria-label="Eliminar producto {{producto.fldNombre}}">
               Eliminar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #noData>
    <p class="no-data">No hay productos registrados.</p>
  </ng-template>

</div>

<div class="modal-backdrop" *ngIf="showModal">
  <div class="modal">

    <!-- CREAR -->
    <form *ngIf="modalMode === 'create'" #productoForm="ngForm" (ngSubmit)="onSubmit(productoForm)">
      <h2>Registrar Producto</h2>

      <label for="nombreInput">Nombre:</label>
      <input id="nombreInput" type="text" [(ngModel)]="productoCreate.fldNombre" name="nombre" required />

      <label for="marcaInput">Marca:</label>
      <input id="marcaInput" type="text" [(ngModel)]="productoCreate.fldMarca" name="marca" required />

      <label for="precioInput">Precio:</label>
      <input id="precioInput" type="number" [(ngModel)]="productoCreate.fldPrecio" name="precio" required />

      <label for="unidadesInput">Unidades:</label>
      <input id="unidadesInput" type="number" [(ngModel)]="productoCreate.unidades" name="unidades" required />

      <label for="categoriaSelectCreate">Categor铆as:</label>
      <select id="categoriaSelectCreate" class="menu-select" multiple [(ngModel)]="productoCreate.categorias" name="categorias" required>
        <option *ngFor="let cat of categorias" [value]="cat.id_categorias">
          {{ cat.fldNombre }}
        </option>
      </select>

      <label for="descripcionInput">Descripci贸n:</label>
      <textarea id="descripcionInput" [(ngModel)]="productoCreate.descripcion" name="descripcion"></textarea>

      <div class="modal-actions">
        <button type="submit" class="btn-primary">Registrar</button>
        <button type="button" class="btn-secondary" (click)="cerrarModal()">Cancelar</button>
      </div>
    </form>

    <!-- EDITAR -->
    <form *ngIf="modalMode === 'edit'" #productoForm="ngForm" (ngSubmit)="onSubmit(productoForm)">
      <h2>Editar Producto</h2>

      <label for="nombreInputEdit">Nombre:</label>
      <input id="nombreInputEdit" type="text" [(ngModel)]="productoEdit.fldNombre" name="nombreEdit" required />

      <label for="marcaInputEdit">Marca:</label>
      <input id="marcaInputEdit" type="text" [(ngModel)]="productoEdit.fldMarca" name="marcaEdit" required />

      <label for="precioInputEdit">Precio:</label>
      <input id="precioInputEdit" type="number" [(ngModel)]="productoEdit.fldPrecio" name="precioEdit" required />

      <label for="unidadesInputEdit">Unidades:</label>
      <input id="unidadesInputEdit" type="number" [(ngModel)]="productoEdit.unidades" name="unidadesEdit" required />

      <label for="categoriaSelectEdit">Categor铆as:</label>
      <select id="categoriaSelectEdit" class="menu-select" multiple [(ngModel)]="productoEdit.categorias" name="categoriasEdit">
        <option *ngFor="let cat of categorias" [value]="cat.id_categorias">
          {{ cat.fldNombre }}
        </option>
      </select>

      <label for="descripcionInputEdit">Descripci贸n:</label>
      <textarea id="descripcionInputEdit" [(ngModel)]="productoEdit.descripcion" name="descripcionEdit"></textarea>

      <div class="modal-actions">
        <button type="submit" class="btn-primary">Guardar Cambios</button>
        <button type="button" class="btn-secondary" (click)="cerrarModal()">Cancelar</button>
      </div>
    </form>

    <!-- ELIMINAR -->
    <div *ngIf="modalMode === 'delete'">
      <h2>驴Eliminar Producto?</h2>
      <p>Esta acci贸n no se puede deshacer.</p>

      <div class="modal-actions">
        <button class="btn-danger" (click)="confirmarEliminar()">Eliminar</button>
        <button class="btn-secondary" (click)="cerrarModal()">Cancelar</button>
      </div>
    </div>

  </div>
</div>
